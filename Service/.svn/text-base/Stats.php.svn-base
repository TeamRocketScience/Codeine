<?php

$Timeout = 2000; // Максимальное время выполнения, миллисекунды.

$Signals = new Collection('_Event_Signal');
$Signals->Query('@All'); // Которые не были обработаны
$Signals->Sort('Priority', 'DESC');
$Signals->Load();

Timing::Go('Event Queue Server');

// Обрабатываем по очереди

$IC = 0;

if ($Signals->Length > 0)
    {
        foreach ($Signals as $Item)
            {
                $IC++;
                if (Timing::Lap('Event Queue Server') < $Timeout)
                {
                    Event::Handle($Item);
                    $Item->Erase();
                }
                else
                    break;
            }
        echo 'Обработано '.$IC.' событий из очереди в '.$Signals->Length;
    }
else
    echo 'В очереди нет событий';

Timing::Stop('Event Queue Server');